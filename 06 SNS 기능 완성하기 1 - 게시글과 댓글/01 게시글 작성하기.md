# 게시글 작성하기 - SNS의 핵심 기능 구현

SNS의 가장 기본적인 기능인 게시글 작성 기능을 구현해보겠습니다. 게시글은 사용자들이 자신의 생각과 경험을 공유할 수 있는 공간입니다.



## 1. 게시글 기능의 설계

게시글을 작성하기 위해서는 아래와 같은 정보가 필요하다고 가정해보겠습니다.
- 게시글 내용 (content)
- 작성자 ID (memberId)
- 작성 시간 (createdAt) 
- 수정 시간 (updatedAt)



### Post 엔티티 만들기

JPA Entity 를 사용하여 우리가 필요로하는 정보를 한 객체에 담아봅시다.

```java
@Entity
@Getter
@Builder
@NoArgsConstructor(access = AccessLevel.PROTECTED)
public class Post {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    // 게시글 내용 (비어있으면 안 됩니다)
    @Column(nullable = false, columnDefinition = "TEXT")
    private String content;

    private Long memberId;

    @Column(nullable = false)
    private LocalDateTime createdAt;

    @Column(nullable = false)
    private LocalDateTime updatedAt;

    // 게시글 내용을 수정할 때 사용하는 메서드
    public void update(String content) {
        this.content = content;
    }
}
```



## 2. 게시글 저장소 만들기

게시글을 데이터베이스에 저장하고 불러오는 기능을 만들어보겠습니다.

```java
public interface PostRepository extends JpaRepository<Post, Long> {
    // 특정 사용자의 모든 게시글을 시간 순으로 가져오기
    List<Post> findByMemberIdOrderByCreatedAtDesc(Long memberId);
    
    // 특정 게시글이 현재 로그인한 사용자의 것인지 확인
    Optional<Post> findByIdAndMemberId(Long id, Long memberId);
}
```





## 3. 게시글 서비스 만들기

이제 실제로 게시글을 작성하고, 수정하고, 삭제하는 기능을 만들어보겠습니다.

```java
@Service
@RequiredArgsConstructor
public class PostService {
    private final PostRepository postRepository;
    private final MemberRepository memberRepository;

    public PostResponse createPost(PostRequest request) {
        Member member = memberRepository.findByUsername(request.getMemberName())
            .orElseThrow(() -> new IllegalArgumentException("사용자를 찾을 수 없습니다"));

        Post post = Post.builder()
            .content(request.getContent())
            .memberId(member.getId())
            .build();

        return PostResponse.from(postRepository.save(post));
    }

    public List<PostResponse> getAllPosts() {
        return postRepository.findAll().stream()
            .map(PostResponse::from)
            .collect(Collectors.toList());
    }

    public List<PostResponse> getMemberPosts(String memberName) {
        Member member = memberRepository.findByName(memberName)
            .orElseThrow(() -> new IllegalArgumentException("사용자를 찾을 수 없습니다"));
        
        return postRepository.findByMemberIdOrderByCreatedAtDesc(member.getId()).stream()
            .map(PostResponse::from)
            .collect(Collectors.toList());
    }

    public PostResponse updatePost(Long postId, PostRequest request) {
        // 현재 사용자의 게시글인지 확인
        Post post = postRepository.findByIdAndMember(postId,
            memberRepository.findByName(request.getMemberName())
                .orElseThrow(() -> new IllegalArgumentException("사용자를 찾을 수 없습니다")))
            .orElseThrow(() -> new IllegalArgumentException("게시글을 찾을 수 없거나 수정 권한이 없습니다"));

        post.update(request.getContent());
        postRepository.save(post);
        return PostResponse.from(post);
    }

    public void deletePost(Long postId) {
        Post post = postRepository.findByIdAndMember(postId,
            memberRepository.findByName(request.getMemberName())
                .orElseThrow(() -> new IllegalArgumentException("사용자를 찾을 수 없습니다")))
            .orElseThrow(() -> new IllegalArgumentException("게시글을 찾을 수 없거나 삭제 권한이 없습니다"));

        postRepository.delete(post);
    }
}
```

위 PostService 클래스는 게시글과 관련된 핵심 비즈니스 로직을 처리합니다.

- createPost() 메서드는 새로운 게시글을 생성합니다. 사용자 이름으로 Member를 찾아서 게시글과 연결하고, Post 엔티티를 생성하여 저장한 후 PostResponse로 변환하여 반환합니다.
- getAllPosts() 메서드는 모든 게시글 목록을 가져옵니다. 저장된 모든 게시글을 조회하여 PostResponse 리스트로 변환합니다.
- getMemberPosts() 메서드는 특정 사용자의 게시글만 가져옵니다. 사용자 이름으로 Member를 찾고 해당 사용자의 게시글만 조회하며, 생성일 기준 내림차순으로 정렬하여 반환합니다.
- updatePost() 메서드는 게시글을 수정합니다. 게시글 ID와 현재 사용자 정보로 수정 권한을 확인하고, 게시글 내용을 업데이트하여 저장한 후 PostResponse로 반환합니다.
- deletePost() 메서드는 게시글을 삭제합니다. 게시글 ID와 현재 사용자 정보로 삭제 권한을 확인한 후 해당 게시글을 데이터베이스에서 삭제합니다.





## 4. Controller 만들기 (API)

마지막으로 클라이언트가 게시글 기능을 사용할 수 있도록 API를 만들어보겠습니다.

```java
@RestController
@RequestMapping("/api/posts")
@RequiredArgsConstructor
public class PostController {
    private final PostService postService;

    // 새로운 게시글 작성하기
    @PostMapping
    public ResponseEntity<PostResponse> createPost(
            @RequestBody PostRequest request) {
        return ResponseEntity.ok(
            postService.createPost(request)
        );
    }

    // 모든 게시글 가져오기
    @GetMapping
    public ResponseEntity<List<PostResponse>> getAllPosts() {
        return ResponseEntity.ok(postService.getAllPosts());
    }

    // 특정 사용자의 게시글 가져오기
    @GetMapping("/member/{memberName}")
    public ResponseEntity<List<PostResponse>> getMemberPosts(
            @PathVariable String memberName) {
        return ResponseEntity.ok(postService.getMemberPosts(memberName));
    }

    // 게시글 수정하기
    @PutMapping("/{postId}")
    public ResponseEntity<PostResponse> updatePost(
            @PathVariable Long postId,
            @RequestBody PostRequest request) {
        return ResponseEntity.ok(
            postService.updatePost(postId, request)
        );
    }

    // 게시글 삭제하기
    @DeleteMapping("/{postId}")
    public ResponseEntity<Void> deletePost(
            @PathVariable Long postId) {
        postService.deletePost(postId);
        return ResponseEntity.noContent().build();
    }
}
```



## 5. 실제 사용해보기

이제 우리가 만든 게시글 기능을 실제로 어떻게 사용하는지 알아보겠습니다.

### 새로운 게시글 작성하기
```bash
curl -X POST http://localhost:8080/api/posts \
     -H "Content-Type: application/json" \
     -d '{"content": "안녕하세요! 첫 게시글입니다."}'
```



### 모든 게시글 가져오기

```bash
curl http://localhost:8080/api/posts
```



### 특정 사용자의 게시글 가져오기

```bash
curl http://localhost:8080/api/posts/member/username
```



### 게시글 수정하기

```bash
curl -X PUT http://localhost:8080/api/posts/1 \
     -H "Content-Type: application/json" \
     -d '{"content": "수정된 게시글입니다."}'
```



### 게시글 삭제하기

```bash
curl -X DELETE http://localhost:8080/api/posts/1
```



## 6. 참고할 점

보안 측면에서는 게시글은 로그인한 사용자만 작성할 수 있어야 하며, 수정과 삭제는 작성자만 할 수 있어야 합니다. 
따라서, API 요청 시 인증 정보를 꼭 확인해야 합니다. 지금은 requst 객체 안에 사용자 이름을 받아와서 하고 있지만, 추후에 인증을 구현한다면 인증 후 들어오는 사용자 이름 정보로 확인하게 변경할 수도 있습니다.

게시글 조회시 예를 들어 게시글이 1만개이상 정말 많다면 어떻게 할까요? 그런데 어차피 우리 화면에 볼 수 있는 건 10개도 되지 않을 거예요. 
이렇듯 게시글이 많을 때는 페이지네이션을 적용하고 성능을 향상 시킬 수 있는데 이 부분은 다음 강의에서 한 번 알아보겠습니다.